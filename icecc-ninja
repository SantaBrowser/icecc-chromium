#!/bin/bash

# Copyright 2017 Opera Software AS. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

# An icecc wrapper for ninja which sets up environment variables and points to
# the tarball generated by icecc-create-env.py
# Make sure you pass an appropriate -j parameter for your cluster.

SOURCEROOT=`pwd`

while [ ! -e "$SOURCEROOT/icecc-tarball" ]
do
    if [ $SOURCEROOT = "/" ]; then
       echo Failed to locate the Chromium source root. Aborting.
       exit 1
    fi
    SOURCEROOT=`realpath $SOURCEROOT/..`
done

export CCACHE_PREFIX=icecc
export ICECC_VERSION=`find $SOURCEROOT/icecc-tarball -name "*.tar.gz"`
export ICECC_CLANG_REMOTE_CPP=1

ninja "$@"
